<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FAZS - Plataforma de Pruebas</title>
  <link rel="icon" href="logo.png" type="image/png" />

  <!-- Chart.js + Zoom Plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <link rel="stylesheet" href="style.css" />
  
</head>
<body>
  <!-- Pull to Refresh Indicator -->
  <div id="pull-to-refresh"><div class="ptr-spinner"></div></div>

  <div id="print-page-one">
  <header class="main-header">
    <div class="header-left">
      <img id="logo-fijo" src="logo.png" alt="Logo" />
      <div class="header-info">
        <h1>Monitor de Consumos - Demo</h1>
        <div class="demo-badge">Ambiente de Pruebas</div>
        <div id="liveClock" class="header-clock">--</div>
        <div id="reportTimestamp" class="print-only"></div>
      </div>
    </div>
    <div class="header-controls">
      <div id="connectionStatus"><span class="status-led"></span><span id="connText">Desconectado</span></div>
      <button id="reportBtn"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg> Informe</button>
      <button id="simFaultBtn" onclick="toggleFaultSimulation()" style="background-color: #dc3545;">‚ö†Ô∏è Simular Falla</button>
      <button id="testModeBtn" onclick="toggleTestMode()" style="background-color: #0d6efd;">üõ†Ô∏è Modo Pruebas</button>
      <button id="mqttTestBtn" onclick="openMqttModal()" style="background-color: #6f42c1;">üì° Prueba MQTT</button>
      <select id="simSpeed" onchange="changeSimulationSpeed(this.value)">
        <option value="2000" selected>Velocidad: Normal (2s)</option>
        <option value="500">Velocidad: R√°pida (0.5s)</option>
        <option value="5000">Velocidad: Lenta (5s)</option>
      </select>
      <button id="darkModeToggle" title="Alternar modo oscuro">Modo oscuro</button>
    </div>
  </header>

  <!-- Resumen Global (KPIs) -->
  <div class="dashboard-grid main-metrics">
    <div class="sts-box kpi-box" style="background: linear-gradient(135deg, #28a745, #1e7e34);">
      <button class="config-btn" onclick="openKpiConfigModal('power')" title="Configurar MQTT" style="color: rgba(255,255,255,0.8);">‚öôÔ∏è</button>
      <div class="sts-title">Potencia Activa Total (Est.)</div>
      <div id="kpi_total_power" class="sts-data">-- <span class="sts-unit">kW</span></div>
      <div id="kpi_power_topic_display" class="topic-display" style="color: rgba(255,255,255,0.7); margin-top: 5px;">Simulaci√≥n</div>
    </div>
    <div class="sts-box kpi-box" style="background: linear-gradient(135deg, #6f42c1, #59359a);">
      <!-- Icono Energ√≠a -->
      <svg class="card-icon" viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
      <button class="config-btn" onclick="openKpiConfigModal('energy')" title="Configurar MQTT" style="color: rgba(255,255,255,0.8);">‚öôÔ∏è</button>
      <div class="sts-title">Total kWh</div>
      <div id="kpi_energy" class="sts-data">-- <span class="sts-unit">kWh</span></div>
      <div id="kpi_energy_topic_display" class="topic-display" style="color: rgba(255,255,255,0.7); margin-top: 5px;">Simulaci√≥n</div>
    </div>
    <div class="sts-box kpi-box" style="background: linear-gradient(135deg, #fd7e14, #c65f0a);">
      <svg class="card-icon" viewBox="0 0 24 24"><path d="M23 6l-9.5 9.5-5-5L1 18"></path><path d="M17 6h6v6"></path></svg>
      <button class="config-btn" onclick="openKpiConfigModal('pf')" title="Configurar MQTT" style="color: rgba(255,255,255,0.8);">‚öôÔ∏è</button>
      <div class="sts-title">Factor de Potencia</div>
      <div id="kpi_pf" class="sts-data">--</div>
      <div id="kpi_pf_topic_display" class="topic-display" style="color: rgba(255,255,255,0.7); margin-top: 5px;">Simulaci√≥n</div>
    </div>
  </div>

  <!-- Grid de 5 Puntos de Medici√≥n -->
  <div class="dashboard-grid">
    <!-- Punto 1 -->
    <div id="point1-cell" class="sts-box">
      <!-- Icono Medidor -->
      <svg class="card-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
      <div id="p1_status_led" class="card-status-led" title="Estado Conexi√≥n"></div>
      <button class="config-btn" onclick="openConfigModal(1)" title="Configurar MQTT">‚öôÔ∏è</button>
      <div class="sts-title">Punto de Medici√≥n 1</div>
      <div class="point-metrics-header">
        <div class="metric-item">
          <div class="metric-label">Voltaje Total</div>
          <div id="p1_v_tot" class="sts-data metric-value">-- <span class="sts-unit">V</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Corriente Total</div>
          <div id="p1_i_tot" class="sts-data metric-value">-- <span class="sts-unit">A</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Potencia</div>
          <div id="p1_kw" class="sts-data metric-value">-- <span class="sts-unit">kW</span></div>
        </div>
      </div>
      <div id="p1_topic_display" class="topic-display">Simulaci√≥n</div>
      <div class="card-action-prompt" onclick="openPointHistory(1)">
        <span>Ver Detalles</span>
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </div>
    </div>

    <!-- Punto 2 -->
    <div id="point2-cell" class="sts-box">
      <svg class="card-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
      <div id="p2_status_led" class="card-status-led" title="Estado Conexi√≥n"></div>
      <button class="config-btn" onclick="openConfigModal(2)" title="Configurar MQTT">‚öôÔ∏è</button>
      <div class="sts-title">Punto de Medici√≥n 2</div>
      <div class="point-metrics-header">
        <div class="metric-item">
          <div class="metric-label">Voltaje Total</div>
          <div id="p2_v_tot" class="sts-data metric-value">-- <span class="sts-unit">V</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Corriente Total</div>
          <div id="p2_i_tot" class="sts-data metric-value">-- <span class="sts-unit">A</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Potencia</div>
          <div id="p2_kw" class="sts-data metric-value">-- <span class="sts-unit">kW</span></div>
        </div>
      </div>
      <div id="p2_topic_display" class="topic-display">Simulaci√≥n</div>
      <div class="card-action-prompt" onclick="openPointHistory(2)">
        <span>Ver Detalles</span>
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </div>
    </div>

    <!-- Punto 3 -->
    <div id="point3-cell" class="sts-box">
      <svg class="card-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
      <div id="p3_status_led" class="card-status-led" title="Estado Conexi√≥n"></div>
      <button class="config-btn" onclick="openConfigModal(3)" title="Configurar MQTT">‚öôÔ∏è</button>
      <div class="sts-title">Punto de Medici√≥n 3</div>
      <div class="point-metrics-header">
        <div class="metric-item">
          <div class="metric-label">Voltaje Total</div>
          <div id="p3_v_tot" class="sts-data metric-value">-- <span class="sts-unit">V</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Corriente Total</div>
          <div id="p3_i_tot" class="sts-data metric-value">-- <span class="sts-unit">A</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Potencia</div>
          <div id="p3_kw" class="sts-data metric-value">-- <span class="sts-unit">kW</span></div>
        </div>
      </div>
      <div id="p3_topic_display" class="topic-display">Simulaci√≥n</div>
      <div class="card-action-prompt" onclick="openPointHistory(3)">
        <span>Ver Detalles</span>
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </div>
    </div>

    <!-- Punto 4 -->
    <div id="point4-cell" class="sts-box">
      <svg class="card-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
      <div id="p4_status_led" class="card-status-led" title="Estado Conexi√≥n"></div>
      <button class="config-btn" onclick="openConfigModal(4)" title="Configurar MQTT">‚öôÔ∏è</button>
      <div class="sts-title">Punto de Medici√≥n 4</div>
      <div class="point-metrics-header">
        <div class="metric-item">
          <div class="metric-label">Voltaje Total</div>
          <div id="p4_v_tot" class="sts-data metric-value">-- <span class="sts-unit">V</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Corriente Total</div>
          <div id="p4_i_tot" class="sts-data metric-value">-- <span class="sts-unit">A</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Potencia</div>
          <div id="p4_kw" class="sts-data metric-value">-- <span class="sts-unit">kW</span></div>
        </div>
      </div>
      <div id="p4_topic_display" class="topic-display">Simulaci√≥n</div>
      <div class="card-action-prompt" onclick="openPointHistory(4)">
        <span>Ver Detalles</span>
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </div>
    </div>

    <!-- Punto 5 -->
    <div id="point5-cell" class="sts-box">
      <svg class="card-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
      <div id="p5_status_led" class="card-status-led" title="Estado Conexi√≥n"></div>
      <button class="config-btn" onclick="openConfigModal(5)" title="Configurar MQTT">‚öôÔ∏è</button>
      <div class="sts-title">Punto de Medici√≥n 5</div>
      <div class="point-metrics-header">
        <div class="metric-item">
          <div class="metric-label">Voltaje Total</div>
          <div id="p5_v_tot" class="sts-data metric-value">-- <span class="sts-unit">V</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Corriente Total</div>
          <div id="p5_i_tot" class="sts-data metric-value">-- <span class="sts-unit">A</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Potencia</div>
          <div id="p5_kw" class="sts-data metric-value">-- <span class="sts-unit">kW</span></div>
        </div>
      </div>
      <div id="p5_topic_display" class="topic-display">Simulaci√≥n</div>
      <div class="card-action-prompt" onclick="openPointHistory(5)">
        <span>Ver Detalles</span>
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </div>
    </div>

    <!-- Panel de Estados (Luces Piloto) -->
    <div id="pilot-panel-cell" class="sts-box">
      <svg class="card-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
      <button class="config-btn" onclick="openPilotConfigModal()" title="Configurar Luces">‚öôÔ∏è</button>
      <div class="sts-title">Panel de Estados</div>
      <div class="pilot-grid">
        <div class="pilot-item">
          <div id="lamp1" class="pilot-light-large inactive"></div>
          <span class="pilot-label">Piloto 1</span>
        </div>
        <div class="pilot-item">
          <div id="lamp2" class="pilot-light-large inactive"></div>
          <span class="pilot-label">Piloto 2</span>
        </div>
        <div class="pilot-item">
          <div id="lamp3" class="pilot-light-large inactive"></div>
          <span class="pilot-label">Piloto 3</span>
        </div>
        <div class="pilot-item">
          <div id="lamp4" class="pilot-light-large inactive"></div>
          <span class="pilot-label">Piloto 4</span>
        </div>
      </div>
      <div id="pilot_topic_display" class="topic-display">Simulaci√≥n</div>
    </div>
  </div>

  <!-- Secci√≥n de Gr√°fico de Tendencias -->
  <div class="chart-section">
    <div class="chart-header">
      <div class="chart-title-text">üìà Tendencia de Corriente en Tiempo Real (5 Puntos)</div>
    </div>
    <div class="chart-container-global">
      <canvas id="globalTrendChart"></canvas>
    </div>
  </div>

  <footer>
    ¬© 2026 Desarrollado por FAZ Automatizacion
  </footer>

  <div class="print-footer-page1">
    ¬© 2026 Desarrollado por FAZ Automatizacion
  </div>
  </div>

  <!-- Contenedor de Notificaciones -->
  <div id="toast-container"></div>

  <!-- Modal Historial Detallado -->
  <div id="historyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header-custom">
        <h2 id="historyModalTitle" style="margin:0; font-size:1.5rem;">Historial</h2>
        <span class="close-modal" onclick="closePointHistory()">&times;</span>
      </div>
      <div class="modal-body-custom">
        <h3 class="section-title">‚ö° Monitor de Fases en Tiempo Real</h3>
        <div class="phases-grid" style="margin-bottom: 20px;">
          <div class="phase-card">
            <div class="phase-title">Fase A</div>
            <div class="phase-row"><span class="phase-lbl">V:</span> <span id="modal_va">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_va_min">--</span> <span class="divider">|</span> Max: <span id="modal_va_max">--</span></div>
            <div class="phase-row"><span class="phase-lbl">I:</span> <span id="modal_ia">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_ia_min">--</span> <span class="divider">|</span> Max: <span id="modal_ia_max">--</span></div>
          </div>
          <div class="phase-card">
            <div class="phase-title">Fase B</div>
            <div class="phase-row"><span class="phase-lbl">V:</span> <span id="modal_vb">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_vb_min">--</span> <span class="divider">|</span> Max: <span id="modal_vb_max">--</span></div>
            <div class="phase-row"><span class="phase-lbl">I:</span> <span id="modal_ib">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_ib_min">--</span> <span class="divider">|</span> Max: <span id="modal_ib_max">--</span></div>
          </div>
          <div class="phase-card">
            <div class="phase-title">Fase C</div>
            <div class="phase-row"><span class="phase-lbl">V:</span> <span id="modal_vc">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_vc_min">--</span> <span class="divider">|</span> Max: <span id="modal_vc_max">--</span></div>
            <div class="phase-row"><span class="phase-lbl">I:</span> <span id="modal_ic">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_ic_min">--</span> <span class="divider">|</span> Max: <span id="modal_ic_max">--</span></div>
          </div>
        </div>
        <div class="chart-container-history">
          <canvas id="historyChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Prueba MQTT -->
  <div id="mqttModal" class="modal">
    <div class="modal-content">
      <div class="modal-header-custom">
        <h2 style="color: #fff; margin: 0;">üì° Diagn√≥stico MQTT</h2>
        <span class="close-modal" onclick="closeMqttModal()">&times;</span>
      </div>
      <div class="modal-body-custom">
        <div class="mqtt-controls">
          <div class="control-group">
            <label>Broker:</label>
            <input type="text" id="mqttBroker" value="broker.hivemq.com" readonly />
          </div>
          <div class="control-group">
            <label>Topic:</label>
            <input type="text" id="mqttTopic" value="data/haiwell/fazsltda/+" />
          </div>
          <button id="btnMqttConnect" onclick="toggleMqttConnection()">Conectar</button>
        </div>
        <div id="mqttStatus" class="status-disconnected" style="margin: 10px 0; font-weight: bold;">Estado: Desconectado</div>
        
        <!-- Panel de Datos en Vivo -->
        <div class="mqtt-live-panel">
          <div class="live-metric">
            <span class="live-label">Estado (Bool):</span>
            <div id="mqttPilot" class="pilot-light"></div>
          </div>
          <div class="live-metric">
            <span class="live-label">Valor (Entero):</span>
            <div id="mqttValue" class="live-value">--</div>
          </div>
        </div>

        <div class="mqtt-log-container">
          <div id="mqttLog"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Configuraci√≥n de Punto -->
  <div id="configModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header-custom">
        <h2 style="color: #fff; margin: 0;">‚öôÔ∏è Configurar Punto <span id="configPointId"></span></h2>
        <span class="close-modal" onclick="closeConfigModal()">&times;</span>
      </div>
      <div class="modal-body-custom">
        <div class="control-group" style="margin-bottom: 15px;">
          <label>Broker MQTT (WSS):</label>
          <input type="text" id="pointBroker" placeholder="wss://broker.hivemq.com:8884/mqtt" style="width: 100%;" />
        </div>
        <div class="control-group" style="margin-bottom: 15px;">
          <label>Topic:</label>
          <input type="text" id="pointTopic" placeholder="data/haiwell/fazsltda/punto1" style="width: 100%;" />
        </div>
        
        <h4 style="margin: 10px 0 5px; color: #666; font-size: 0.9rem;">Mapeo de Datos (Claves JSON)</h4>
        <div class="control-group" style="margin-bottom: 5px;">
          <label style="font-weight: normal; font-size: 0.8rem;">Voltaje Total:</label>
          <input type="text" id="keyVoltaje" placeholder="Ej: voltaje_L_L" style="width: 100%;" />
        </div>
        <div class="control-group" style="margin-bottom: 5px;">
          <label style="font-weight: normal; font-size: 0.8rem;">Corriente Total:</label>
          <input type="text" id="keyCorriente" placeholder="Ej: corriente_total" style="width: 100%;" />
        </div>
        <div class="control-group" style="margin-bottom: 20px;">
          <label style="font-weight: normal; font-size: 0.8rem;">Potencia (kW):</label>
          <input type="text" id="keyPotencia" placeholder="Ej: potencia_activa" style="width: 100%;" />
        </div>

        <h4 style="margin: 10px 0 5px; color: #666; font-size: 0.9rem;">Mapeo de Fases (Opcional)</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
          <div>
            <label style="font-size: 0.75rem;">Voltaje Fase A:</label>
            <input type="text" id="keyVa" placeholder="Ej: v_a" style="width: 100%; padding: 6px;" />
            <label style="font-size: 0.75rem; margin-top: 5px;">Corriente Fase A:</label>
            <input type="text" id="keyIa" placeholder="Ej: i_a" style="width: 100%; padding: 6px;" />
          </div>
          <!-- Nota: Para simplificar la UI, asumiremos patrones o agregaremos m√°s campos si es necesario. Por ahora agregamos los principales -->
          <!-- Se pueden agregar Vb, Vc, Ib, Ic aqu√≠ si se requiere control total -->
          <div style="grid-column: 1 / -1; font-size: 0.75rem; color: #888; font-style: italic;">
            * Configure las claves para Fase A. El sistema intentar√° inferir B y C o puede agregar m√°s campos en el c√≥digo. (Para esta demo, agregaremos todos los campos en el script).
          </div>
        </div>

        <h4 style="margin: 10px 0 5px; color: #666; font-size: 0.9rem; border-top: 1px solid #eee; padding-top: 10px;">Prueba de Mapeo</h4>
        <div class="control-group" style="margin-bottom: 10px;">
            <label for="jsonSamplePayload" style="font-weight: normal; font-size: 0.8rem;">JSON de Ejemplo:</label>
            <textarea id="jsonSamplePayload" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; font-size: 0.8rem; resize: vertical;" placeholder='Pegue aqu√≠ un JSON de ejemplo: {"voltaje": 380, ...}'></textarea>
        </div>
        <button onclick="testJsonMapping()" style="width: 100%; background-color: #6f42c1; margin-bottom: 15px; padding: 8px;">Probar Mapeo</button>
        <div id="mappingResult" style="display:none; background: #f8f9fa; padding: 10px; border-radius: 4px; border: 1px solid #ddd; font-size: 0.85rem; margin-bottom: 15px; color: #333;"></div>

        <button onclick="savePointConfig()" style="width: 100%; background-color: #28a745;">Guardar Configuraci√≥n</button>
        <button onclick="clearPointConfig()" style="width: 100%; background-color: #dc3545; margin-top: 10px; margin-left: 0;">Restaurar a Simulaci√≥n</button>
      </div>
    </div>
  </div>

  <!-- Modal Configuraci√≥n Luces Piloto -->
  <div id="pilotConfigModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header-custom">
        <h2 style="color: #fff; margin: 0;">‚öôÔ∏è Configurar Luces Piloto</h2>
        <span class="close-modal" onclick="closePilotConfigModal()">&times;</span>
      </div>
      <div class="modal-body-custom">
        <div class="control-group" style="margin-bottom: 15px;">
          <label>Broker MQTT (WSS):</label>
          <input type="text" id="pilotBroker" placeholder="wss://broker.hivemq.com:8884/mqtt" style="width: 100%;" />
        </div>
        <div class="control-group" style="margin-bottom: 15px;">
          <label>Topic Base:</label>
          <input type="text" id="pilotTopic" placeholder="data/haiwell/fazsltda/estados" style="width: 100%;" />
        </div>
        
        <h4 style="margin: 10px 0 5px; color: #666; font-size: 0.9rem;">Mapeo de Claves (JSON Boolean)</h4>
        <div class="control-group" style="margin-bottom: 5px;">
          <label style="font-weight: normal; font-size: 0.8rem;">Piloto 1 Key:</label>
          <input type="text" id="keyLamp1" placeholder="Ej: estado_bomba" style="width: 100%;" />
        </div>
        <div class="control-group" style="margin-bottom: 5px;">
          <label style="font-weight: normal; font-size: 0.8rem;">Piloto 2 Key:</label>
          <input type="text" id="keyLamp2" placeholder="Ej: alarma_falla" style="width: 100%;" />
        </div>
        <div class="control-group" style="margin-bottom: 5px;">
          <label style="font-weight: normal; font-size: 0.8rem;">Piloto 3 Key:</label>
          <input type="text" id="keyLamp3" placeholder="Ej: nivel_alto" style="width: 100%;" />
        </div>
        <div class="control-group" style="margin-bottom: 20px;">
          <label style="font-weight: normal; font-size: 0.8rem;">Piloto 4 Key:</label>
          <input type="text" id="keyLamp4" placeholder="Ej: puerta_abierta" style="width: 100%;" />
        </div>

        <button onclick="savePilotConfig()" style="width: 100%; background-color: #28a745;">Guardar Configuraci√≥n</button>
        <button onclick="clearPilotConfig()" style="width: 100%; background-color: #dc3545; margin-top: 10px; margin-left: 0;">Restaurar a Simulaci√≥n</button>
      </div>
    </div>
  </div>

  <!-- Modal Configuraci√≥n KPI (Tarjetas Grandes) -->
  <div id="kpiConfigModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header-custom">
        <h2 style="color: #fff; margin: 0;">‚öôÔ∏è Configurar KPI: <span id="configKpiName"></span></h2>
        <span class="close-modal" onclick="closeKpiConfigModal()">&times;</span>
      </div>
      <div class="modal-body-custom">
        <div class="control-group" style="margin-bottom: 15px;">
          <label>Broker MQTT (WSS):</label>
          <input type="text" id="kpiBroker" placeholder="wss://broker.hivemq.com:8884/mqtt" style="width: 100%;" />
        </div>
        <div class="control-group" style="margin-bottom: 15px;">
          <label>Topic:</label>
          <input type="text" id="kpiTopic" placeholder="data/kpi/valor" style="width: 100%;" />
        </div>
        <div class="control-group" style="margin-bottom: 20px;">
          <label>Clave JSON (Valor):</label>
          <input type="text" id="kpiKey" placeholder="Ej: valor" style="width: 100%;" />
        </div>
        <button onclick="saveKpiConfig()" style="width: 100%; background-color: #28a745;">Guardar Configuraci√≥n</button>
        <button onclick="clearKpiConfig()" style="width: 100%; background-color: #dc3545; margin-top: 10px; margin-left: 0;">Restaurar a Simulaci√≥n</button>
      </div>
    </div>
  </div>

<script src="script.js"></script>
</body>
</html>