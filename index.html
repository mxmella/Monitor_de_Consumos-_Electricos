<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Monitor de Consumos El√©ctricos</title>
  <link rel="icon" href="logo.png" type="image/png">
  <link rel="manifest" href="manifest.json">

  <!-- Chart.js + Zoom Plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <link rel="stylesheet" href="style.css">
  
</head>
<body>
  <div id="print-page-one">
  <header class="main-header">
    <div class="header-left">
      <img id="logo-fijo" src="logo.png" alt="Logo" />
      <div class="header-info">
        <h1>Monitor de Consumos El√©ctricos - 5 Puntos</h1>
        <div id="liveClock" class="header-clock">--</div>
        <div id="reportTimestamp" class="print-only"></div>
      </div>
    </div>
    <div class="header-controls">
      <div id="connectionStatus"><span class="status-led"></span><span id="connText">Desconectado</span></div>
      <button id="reportBtn"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg> Informe</button>
      <button id="simFaultBtn" onclick="toggleFaultSimulation()" style="background-color: #dc3545;">‚ö†Ô∏è Simular Falla</button>
      <button id="darkModeToggle" title="Alternar modo oscuro">Modo oscuro</button>
    </div>
  </header>

  <!-- Resumen Global (KPIs) -->
  <div class="dashboard-grid main-metrics">
    <div class="sts-box kpi-box" style="background: linear-gradient(135deg, #28a745, #1e7e34);">
      <div class="sts-title">Potencia Activa Total (Est.)</div>
      <div id="kpi_total_power" class="sts-data">-- <span class="sts-unit">kW</span></div>
    </div>
    <div class="sts-box kpi-box" style="background: linear-gradient(135deg, #6f42c1, #59359a);">
      <!-- Icono Energ√≠a -->
      <svg class="card-icon" viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
      <div class="sts-title">Total kWh</div>
      <div id="kpi_energy" class="sts-data">-- <span class="sts-unit">kWh</span></div>
    </div>
    <div class="sts-box kpi-box" style="background: linear-gradient(135deg, #fd7e14, #c65f0a);">
      <svg class="card-icon" viewBox="0 0 24 24"><path d="M23 6l-9.5 9.5-5-5L1 18"></path><path d="M17 6h6v6"></path></svg>
      <div class="sts-title">Factor de Potencia</div>
      <div id="kpi_pf" class="sts-data">--</div>
    </div>
  </div>

  <!-- Grid de 5 Puntos de Medici√≥n -->
  <div class="dashboard-grid">
    <!-- Punto 1 -->
    <div id="point1-cell" class="sts-box">
      <!-- Icono Medidor -->
      <svg class="card-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
      <div class="sts-title">Punto de Medici√≥n 1</div>
      <div class="point-metrics-header">
        <div class="metric-item">
          <div class="metric-label">Voltaje Total</div>
          <div id="p1_v_tot" class="sts-data metric-value">-- <span class="sts-unit">V</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Corriente Total</div>
          <div id="p1_i_tot" class="sts-data metric-value">-- <span class="sts-unit">A</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Potencia</div>
          <div id="p1_kw" class="sts-data metric-value">-- <span class="sts-unit">kW</span></div>
        </div>
      </div>
      <div class="card-action-prompt" onclick="openPointHistory(1)">
        <span>Ver Detalles</span>
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </div>
    </div>

    <!-- Punto 2 -->
    <div id="point2-cell" class="sts-box">
      <svg class="card-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
      <div class="sts-title">Punto de Medici√≥n 2</div>
      <div class="point-metrics-header">
        <div class="metric-item">
          <div class="metric-label">Voltaje Total</div>
          <div id="p2_v_tot" class="sts-data metric-value">-- <span class="sts-unit">V</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Corriente Total</div>
          <div id="p2_i_tot" class="sts-data metric-value">-- <span class="sts-unit">A</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Potencia</div>
          <div id="p2_kw" class="sts-data metric-value">-- <span class="sts-unit">kW</span></div>
        </div>
      </div>
      <div class="card-action-prompt" onclick="openPointHistory(2)">
        <span>Ver Detalles</span>
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </div>
    </div>

    <!-- Punto 3 -->
    <div id="point3-cell" class="sts-box">
      <svg class="card-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
      <div class="sts-title">Punto de Medici√≥n 3</div>
      <div class="point-metrics-header">
        <div class="metric-item">
          <div class="metric-label">Voltaje Total</div>
          <div id="p3_v_tot" class="sts-data metric-value">-- <span class="sts-unit">V</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Corriente Total</div>
          <div id="p3_i_tot" class="sts-data metric-value">-- <span class="sts-unit">A</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Potencia</div>
          <div id="p3_kw" class="sts-data metric-value">-- <span class="sts-unit">kW</span></div>
        </div>
      </div>
      <div class="card-action-prompt" onclick="openPointHistory(3)">
        <span>Ver Detalles</span>
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </div>
    </div>

    <!-- Punto 4 -->
    <div id="point4-cell" class="sts-box">
      <svg class="card-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
      <div class="sts-title">Punto de Medici√≥n 4</div>
      <div class="point-metrics-header">
        <div class="metric-item">
          <div class="metric-label">Voltaje Total</div>
          <div id="p4_v_tot" class="sts-data metric-value">-- <span class="sts-unit">V</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Corriente Total</div>
          <div id="p4_i_tot" class="sts-data metric-value">-- <span class="sts-unit">A</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Potencia</div>
          <div id="p4_kw" class="sts-data metric-value">-- <span class="sts-unit">kW</span></div>
        </div>
      </div>
      <div class="card-action-prompt" onclick="openPointHistory(4)">
        <span>Ver Detalles</span>
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </div>
    </div>

    <!-- Punto 5 -->
    <div id="point5-cell" class="sts-box">
      <svg class="card-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
      <div class="sts-title">Punto de Medici√≥n 5</div>
      <div class="point-metrics-header">
        <div class="metric-item">
          <div class="metric-label">Voltaje Total</div>
          <div id="p5_v_tot" class="sts-data metric-value">-- <span class="sts-unit">V</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Corriente Total</div>
          <div id="p5_i_tot" class="sts-data metric-value">-- <span class="sts-unit">A</span></div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Potencia</div>
          <div id="p5_kw" class="sts-data metric-value">-- <span class="sts-unit">kW</span></div>
        </div>
      </div>
      <div class="card-action-prompt" onclick="openPointHistory(5)">
        <span>Ver Detalles</span>
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
      </div>
    </div>
  </div>

  <!-- Secci√≥n de Gr√°fico de Tendencias -->
  <div class="chart-section">
    <div class="chart-header">
      <div class="chart-title-text">üìà Tendencia de Corriente en Tiempo Real (5 Puntos)</div>
    </div>
    <div style="position: relative; height: 350px; width: 100%;">
      <canvas id="globalTrendChart"></canvas>
    </div>
  </div>

  <footer>
    ¬© 2026 Desarrollado por FAZ Automatizacion
  </footer>

  <div class="print-footer-page1">
    ¬© 2026 Desarrollado por FAZ Automatizacion
  </div>
  </div>

  <!-- Contenedor de Notificaciones -->
  <div id="toast-container"></div>

  <!-- Modal Historial Detallado -->
  <div id="historyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header-custom">
        <h2 id="historyModalTitle" style="margin:0; font-size:1.5rem;">Historial</h2>
        <span class="close-modal" onclick="closePointHistory()">&times;</span>
      </div>
      <div class="modal-body-custom">
        <h3 class="section-title">‚ö° Monitor de Fases en Tiempo Real</h3>
        <div class="phases-grid" style="margin-bottom: 20px;">
          <div class="phase-card">
            <div class="phase-title">Fase A</div>
            <div class="phase-row"><span class="phase-lbl">V:</span> <span id="modal_va">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_va_min">--</span> <span class="divider">|</span> Max: <span id="modal_va_max">--</span></div>
            <div class="phase-row"><span class="phase-lbl">I:</span> <span id="modal_ia">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_ia_min">--</span> <span class="divider">|</span> Max: <span id="modal_ia_max">--</span></div>
          </div>
          <div class="phase-card">
            <div class="phase-title">Fase B</div>
            <div class="phase-row"><span class="phase-lbl">V:</span> <span id="modal_vb">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_vb_min">--</span> <span class="divider">|</span> Max: <span id="modal_vb_max">--</span></div>
            <div class="phase-row"><span class="phase-lbl">I:</span> <span id="modal_ib">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_ib_min">--</span> <span class="divider">|</span> Max: <span id="modal_ib_max">--</span></div>
          </div>
          <div class="phase-card">
            <div class="phase-title">Fase C</div>
            <div class="phase-row"><span class="phase-lbl">V:</span> <span id="modal_vc">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_vc_min">--</span> <span class="divider">|</span> Max: <span id="modal_vc_max">--</span></div>
            <div class="phase-row"><span class="phase-lbl">I:</span> <span id="modal_ic">--</span></div>
            <div class="phase-sub-row">Min: <span id="modal_ic_min">--</span> <span class="divider">|</span> Max: <span id="modal_ic_max">--</span></div>
          </div>
        </div>
        <div style="position: relative; height: 400px; width: 100%;">
          <canvas id="historyChart"></canvas>
        </div>
      </div>
    </div>
  </div>

<script src="script.js"></script>
</body>
</html>